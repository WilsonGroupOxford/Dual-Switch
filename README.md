Dual Switch: refactored and developed version of dual_switching code
